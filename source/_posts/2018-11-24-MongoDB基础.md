---
title: MongoDBåŸºç¡€
date: 2018-11-24 00:00:00
tags: æ•°æ®åº“
---

![MongoDB](./mongodb.png)

# 0.æ•°æ®åº“å¯åŠ¨/å…³é—­ ğŸ•
å¯åŠ¨mongonDB:
C:\mongo\mongodb\bin >>
``` shell
mongod --dbpath C:\mongo\mongodb\data\db
mongod --dbpath C:\mongo\mongodb\data\db --repair # å¼‚å¸¸å…³é—­æ—¶é‡å¯
```

å…³é—­mongodb:
mongo_shell >>

```
use admin
db.shutdownServer()
```

---

# 1.æ•°æ®åº“çš„å¯¼å…¥å’Œå¯¼å‡º ğŸ”
``` shell 
æœ¬åœ°:127.0.0.1:27017
çº¿ä¸Š:xxx.xxx.xx.xxx:xxxxx-u xxxx -p xxxxxxxx

**BSON**
bsonæ ¼å¼å¯¼å‡º
mongodump -h 127.0.0.1:27017 -d xxxx -c xxxx -o ./
mongodump -h xxx.xxx.xx.xxx:xxxx -d xxxx -c xxxx -u xxxx -p xxxxxxxx -o ./
bsonæ ¼å¼å¯¼å…¥
mongorestore -h xxx.xxx.xx.xxx:xxxx -d xxxx --dir F:\xxxx -u xxxx -p xxxxxxxx
mongorestore -h 127.0.0.1:27017 -d xxxx--dir F:\xxxx\xxxx

**JSON**
jsonæ ¼å¼å¯¼å‡º
mongoexport -h xxx.xxx.xx.xxx:xxxx -d xxxx-c xxxx -u xxxx -p xxxxxxxx --out name.json
jsonæ ¼å¼å¯¼å…¥
mongoimport -h xxx.xxx.xx.xxx:xxxx -d xxxx -c xxxx --file name.json -u xxxx -p xxxxxxxx
mongoimport -h xxx.xxx.xx.xxx:xxxx -d xxxx -c xxxx (--drop) --file name.json -u xxxx -p xxxxxxxx
```

---

# 2.æ›´æ–°å’Œåˆ é™¤ å­—æ®µ ğŸŸ

**ä¿®æ”¹** å­—æ®µå

``` js
db.getCollection('pydb').update({}, {$rename : {"pop" : "abc"}}, false, true)
db.getCollection('SS_UniversityInfo').update({}, {$rename : {"XuanKaoScrope" : "SubjectScope"}}, false, true)
```

å‚æ•°è¯´æ˜ï¼š
db.collection.update(criteria,objNew,upsert,multi)
**criteria** ï¼šæŸ¥è¯¢æ¡ä»¶
**objNew** ï¼šupdateå¯¹è±¡å’Œä¸€äº›æ›´æ–°æ“ä½œç¬¦
**upsert** ï¼šå¦‚æœä¸å­˜åœ¨updateçš„è®°å½•ï¼Œæ˜¯å¦æ’å…¥objNewè¿™ä¸ªæ–°çš„æ–‡æ¡£ï¼Œtrueä¸ºæ’å…¥ï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸æ’å…¥ã€‚
**multi** ï¼šé»˜è®¤æ˜¯falseï¼Œåªæ›´æ–°æ‰¾åˆ°çš„ç¬¬ä¸€æ¡è®°å½•ã€‚å¦‚æœä¸ºtrueï¼ŒæŠŠæŒ‰æ¡ä»¶æŸ¥è¯¢å‡ºæ¥çš„è®°å½•å…¨éƒ¨æ›´æ–°


**æ›´æ–°** å­—æ®µ

```js
db.table.update({}, {$set: {content:"xxx"}}, false,true)
```

**åˆ é™¤** å­—æ®µ

``` js
db.table.update({},{$unset:{content:""}},false, true)
```

---
## ç»ƒä¹  ğŸ¤

* ä¿®æ”¹åˆ—è¡¨é‡Œçš„å­—å…¸é‡Œçš„å­—æ®µå

```js
// æŠŠXuanKaoSubjectScrope å­—æ®µæ”¹æˆ Scrope
[
    {
        "SubjectScope":[
            {"XuanKaoSubjectScrope":"x1"},
            {"XuanKaoSubjectScrope":"x2"},
            {"XuanKaoSubjectScrope":"x3"},
        ]
    },
    {},
    {}...
]
```

```js
// [æœªå®Œç¾è§£å†³] å½“æ—¶é‡‡ç”¨çš„æ–¹æ³•æ˜¯å¯¼å‡ºjsonå†æ›¿æ¢æ–‡æœ¬ğŸ˜‚
db.getCollection('SS_UniversityInfo').update(
    {"SubjectScope":{
        "$elemMatch":{
            "XuanKaoSubjectScrope":{
                "$exists":true}}}},
    {"$rename":{
        "$SubjectScope.$.XuanKaoSubjectScrope":"SubjectScope.$.Scrope"}
        },
    false,
    true)
```

``` js
// ç°åœ¨å‘ç°å¯ä»¥å†™pythonæˆ–jsè„šæœ¬è§£å†³
```

---

* æ­£åˆ™å¯»æ‰¾ä¸ä»¥cn/com/org/net/hk/eduç»“å°¾çš„å­—æ®µ

```js
db.getCollection('SS_UniversityInfo').find({"WebSite":{"$not":/cn$|com$|org$|net$|hk$|edu$/}})

db.getCollection('SS_UniversityInfo').find({"WebSite":{"$regex":"net$|com$"}})
```

* [MongoDBé€»è¾‘æ“ä½œç¬¦$or, $and,$not,$nor](https://blog.csdn.net/yaomingyang/article/details/75103480)

---
 

# 3.MogoDB èšåˆ ğŸ³
* [èœé¸Ÿæ•™ç¨‹ MongoDB èšåˆ](http://www.runoob.com/mongodb/mongodb-aggregate.html)

ç®¡é“åœ¨Unixå’ŒLinuxä¸­ä¸€èˆ¬ç”¨äºå°†å½“å‰å‘½ä»¤çš„ **è¾“å‡ºç»“æœ** ä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„ **å‚æ•°** ã€‚
MongoDBçš„èšåˆç®¡é“å°†MongoDBæ–‡æ¡£åœ¨ä¸€ä¸ªç®¡é“å¤„ç†å®Œæ¯•åå°†ç»“æœ**ä¼ é€’**ç»™ä¸‹ä¸€ä¸ªç®¡é“å¤„ç†ã€‚
ç®¡é“æ“ä½œæ˜¯å¯ä»¥**é‡å¤**çš„ã€‚

ç®€å•ä»‹ç»ä¸€ä¸‹èšåˆä¸­å¸¸ç”¨çš„å‡ ä¸ªå‚æ•°ï¼š

```py
$projectï¼šä¿®æ”¹è¾“å…¥æ–‡æ¡£çš„ç»“æ„ã€‚å¯ä»¥ç”¨æ¥é‡å‘½åã€å¢åŠ æˆ–åˆ é™¤åŸŸï¼Œä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºè®¡ç®—ç»“æœä»¥åŠåµŒå¥—æ–‡æ¡£ã€‚
$matchï¼šç”¨äºè¿‡æ»¤æ•°æ®ï¼Œåªè¾“å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ã€‚$matchä½¿ç”¨MongoDBçš„æ ‡å‡†æŸ¥è¯¢æ“ä½œã€‚
$limitï¼šç”¨æ¥é™åˆ¶MongoDBèšåˆç®¡é“è¿”å›çš„æ–‡æ¡£æ•°ã€‚
$skipï¼šåœ¨èšåˆç®¡é“ä¸­è·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ï¼Œå¹¶è¿”å›ä½™ä¸‹çš„æ–‡æ¡£ã€‚
$unwindï¼šå°†æ–‡æ¡£ä¸­çš„æŸä¸€ä¸ªæ•°ç»„ç±»å‹å­—æ®µæ‹†åˆ†æˆå¤šæ¡ï¼Œæ¯æ¡åŒ…å«æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼ã€‚
$groupï¼šå°†é›†åˆä¸­çš„æ–‡æ¡£åˆ†ç»„ï¼Œå¯ç”¨äºç»Ÿè®¡ç»“æœã€‚
$sortï¼šå°†è¾“å…¥æ–‡æ¡£æ’åºåè¾“å‡ºã€‚
$geoNearï¼šè¾“å‡ºæ¥è¿‘æŸä¸€åœ°ç†ä½ç½®çš„æœ‰åºæ–‡æ¡£
```
